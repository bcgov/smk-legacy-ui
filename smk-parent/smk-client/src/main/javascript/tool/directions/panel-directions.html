<side-panel class="smk-directions-panel" v-bind:class="{ 'smk-busy': busy }">
    <template slot="header">
        <h1>Route Planner</h1>
        <div class="smk-spinner"></div>
    </template>

    <template slot="commands">
        <span class="smk-command-col">
            <div class="smk-command"
                v-bind:class="{ 'smk-disabled': busy }"
                v-on:click="!busy && $$emit( 'reverse' )"
            >Reverse</div>

            <div class="smk-command"
                v-bind:class="{ 'smk-disabled': busy }"
                v-on:click="!busy && $$emit( 'clear' )"
            >Reset</div>
        </span>

        <span class="smk-command-col">
            <label class="smk-command"
                v-bind:class="{ 'smk-disabled': busy }"
            ><input type="checkbox"
                v-model="optimal"
                v-on:change="!busy && $$emit( 'config', getConfigState() )"
            >Optimal order</label>

            <label class="smk-command"
                v-bind:class="{ 'smk-disabled': busy }"
            ><input type="checkbox"
                v-model="roundTrip"
                v-on:change="!busy && $$emit( 'config', getConfigState() )"
            >Round trip</label>
        </span>

        <span class="smk-command-col">
            <label class="smk-command"
                v-bind:class="{ 'smk-disabled': busy }"
            ><input type="radio" value="shortest"
                v-model="criteria"
                v-on:change="!busy && $$emit( 'config', getConfigState() )"
            >Shortest</label>

            <label class="smk-command"
                v-bind:class="{ 'smk-disabled': busy }"
            ><input type="radio" value="fastest"
                v-model="criteria"
                v-on:change="!busy && $$emit( 'config', getConfigState() )"
            >Fastest</label>
        </span>
    </template>

    <div class="smk-message"
        v-bind:class="messageClass"
    >
        <span>{{ message }}</span>
    </div>

    <draggable class="smk-waypoints"
        v-bind:list="waypoints"
        v-bind:options="{ handle: '.smk-handle', disabled: optimal }"
        v-on:end="$$emit( 'changed-waypoints' )"
    >
        <div class="smk-waypoint smk-item"
            v-for="( node, i ) in waypoints"
        >
            <i class="smk-command smk-icon smk-handle material-icons"
                v-bind:class="{ 'smk-disabled': optimal || busy }"
                v-bind:title="optimal ? 'Optimal order' : 'Drag to reorder'"
            >drag_handle</i>

            <address-search class="smk-description" placeholder="Click on point, or enter address"
                v-model="node.description"
                v-on:update="$$emit( 'update-waypoint', { index: i, item: $event } )"
            ></address-search>

            <i class="smk-command smk-icon smk-zoomto material-icons" title="Zoom to this waypoint"
                v-on:click="node.location && $$emit( 'zoom-waypoint', { location: node.location, index: i } )"
                v-bind:class="{
                    'smk-disabled': !node.location,
                    'smk-first':    firstWaypointIndex == i,
                    'smk-middle':   node.location && firstWaypointIndex != i && lastWaypointIndex != i,
                    'smk-last':     lastWaypointIndex == i && firstWaypointIndex != i
                }"
            >location_on</i>

            <i class="smk-command smk-icon smk-remove material-icons" title="Remove this waypoint"
                v-on:click="waypoints.length > 2 && node.location && $$emit( 'remove-waypoint', { index: i } )"
                v-bind:class="{ 'smk-disabled': !node.location || waypoints.length < 3 || busy }"
            >delete</i>
        </div>
    </draggable>

    <div class="smk-directions">
        <div class="smk-direction"
            v-for="( direction, i ) in directions"
            v-on:mouseenter="$$emit( 'hover-direction', { highlight: i } )"
            v-on:mouseleave="$$emit( 'hover-direction', { highlight: null } )"
            v-on:click="$$emit( 'pick-direction', { pick: i } )"
            v-bind:class="{ 'smk-highlight': i == directionHighlight, 'smk-pick': i == directionPick }"
        >
            <span class="smk-instruction">{{ direction.instruction }}</span>
            <span class="smk-metric"
                v-if="direction.distance"
            >for {{ direction.distance }} ({{ direction.time }})</span>
        </div>
    </div>

</side-panel>