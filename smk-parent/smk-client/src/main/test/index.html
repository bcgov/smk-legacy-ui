<!doctype html>
<html>
    <head>
        <title>STANDALONE</title>
        <!-- STATIC -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.jquery.min.js"></script>
        <link href="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="test-settings.css">
        <!-- <script src="test-settings.js"></script> -->
        <!-- DYNAMIC LOADED -->
    </head>
    <body >
        <div id="smk-map-frame"></div>

        <div id="test-settings">
            <select id="config" data-placeholder="Config..." multiple name="smk-config" style="display:none">
            </select>

            <div id="tools">
                <input id="apply" type="button" value="Apply">
            </div>
        </div>

        <div id="wait">Get Ready!</div>

        <template id="smk-script">
            <script src="../smk-bootstrap.js" smk-disconnected smk-standalone
                smk-container-id=""
                smk-config=""
            ></script>
        </template>

        <script>
            var filelist = <%= filelist %>

            $( function () {
                $( '#apply' ).click( function () {
                    document.location.search = $( '#config' ).serialize()
                } )

                $( '#wait' ).fadeOut( 5000, function () {
                    document.querySelector( 'head' ).appendChild( document.querySelector( '#smk-script' ).content )

                    var id = setInterval( function () {
                        if ( !window.SMK || !window.SMK.BOOT ) return
                        clearInterval( id )

                        window.SMK.BOOT.then( function () {
                            smkBooted()
                        } )
                    }, 100 )
                } )
            } )

            function smkBooted() {
                $( '#config' )
                    .show()
                    .chosen( {
                        no_results_text: "Nothing selected"
                    } )
                    .append( filelist.configs.map( function ( c ) {
                        return $( '<option>' )
                            .attr( 'value', './config/' + c.path )
                            .text( c.path.replace( '.json', '' ) )
                    } ) )
                    .change( function ( ev ) {
                        $( '#tools' ).show()
                    } )
                    .val( SMK.MAP[ 'smk-map-frame' ].$option.config )
                    .trigger( 'chosen:updated' )
            }
        </script>
    </body>
</html>

